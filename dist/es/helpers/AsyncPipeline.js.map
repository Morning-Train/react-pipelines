{"version":3,"file":"AsyncPipeline.js","sources":["../../../src/helpers/AsyncPipeline.js"],"sourcesContent":["import React from 'react';\nimport { observable } from 'mobx';\nimport PipelineContext from '../contexts/PipelineContext';\n\nfunction AsyncPipeline(props) {\n  const isPipingRef = React.useRef(observable.box());\n\n  const pipesRef = React.useRef({});\n  const pipes = pipesRef.current;\n\n  const pipesOrderRef = React.useRef([]);\n  const pipesOrder = pipesOrderRef.current;\n\n  const pipeline = {};\n\n  pipeline.pipe = (uuid, pipe) => {\n    if (!pipesOrder.includes(uuid)) {\n      pipesOrder.push(uuid);\n    }\n\n    pipes[uuid] = pipe;\n\n    return () => {\n      pipeline.remove(uuid);\n    };\n  };\n\n  pipeline.remove = (uuid) => {\n    if (pipes[uuid]) {\n      delete pipes[uuid];\n    }\n  };\n\n  pipeline.trigger = (payload = {}) => new Promise((resolve, reject) => {\n    isPipingRef.current.set(true);\n\n    const promises = [];\n\n    if (pipesOrder.length > 0) {\n      pipesOrder.forEach((pipeUuid) => {\n        promises.push(\n          Promise.resolve(payload).then((payload) => {\n            const pipe = pipes[pipeUuid];\n            return (typeof (pipe) === 'function') ? pipe(payload) : pipe;\n          }),\n        );\n      });\n    }\n\n    Promise.all(promises)\n      .then((payload) => {\n        isPipingRef.current.set(false);\n        resolve(payload);\n      })\n      .catch((err) => {\n        isPipingRef.current.set(false);\n        reject(err);\n      });\n  });\n\n  pipeline.isPiping = isPipingRef.current;\n\n  return (\n    <PipelineContext.Provider value={pipeline}>\n      {props.children}\n    </PipelineContext.Provider>\n  );\n}\n\nexport default AsyncPipeline;\n"],"names":["AsyncPipeline","props","isPipingRef","React","useRef","observable","box","pipesRef","pipes","current","pipesOrderRef","pipesOrder","pipeline","pipe","uuid","includes","push","remove","trigger","payload","Promise","resolve","reject","set","promises","length","forEach","pipeUuid","then","all","catch","err","isPiping","children"],"mappings":";;;;AAIA,SAASA,aAAT,CAAuBC,KAAvB,EAA8B;AAC5B,MAAMC,WAAW,GAAGC,KAAK,CAACC,MAAN,CAAaC,UAAU,CAACC,GAAX,EAAb,CAApB;AAEA,MAAMC,QAAQ,GAAGJ,KAAK,CAACC,MAAN,CAAa,EAAb,CAAjB;AACA,MAAMI,KAAK,GAAGD,QAAQ,CAACE,OAAvB;AAEA,MAAMC,aAAa,GAAGP,KAAK,CAACC,MAAN,CAAa,EAAb,CAAtB;AACA,MAAMO,UAAU,GAAGD,aAAa,CAACD,OAAjC;AAEA,MAAMG,QAAQ,GAAG,EAAjB;;AAEAA,EAAAA,QAAQ,CAACC,IAAT,GAAgB,UAACC,IAAD,EAAOD,IAAP,EAAgB;AAC9B,QAAI,CAACF,UAAU,CAACI,QAAX,CAAoBD,IAApB,CAAL,EAAgC;AAC9BH,MAAAA,UAAU,CAACK,IAAX,CAAgBF,IAAhB;AACD;;AAEDN,IAAAA,KAAK,CAACM,IAAD,CAAL,GAAcD,IAAd;AAEA,WAAO,YAAM;AACXD,MAAAA,QAAQ,CAACK,MAAT,CAAgBH,IAAhB;AACD,KAFD;AAGD,GAVD;;AAYAF,EAAAA,QAAQ,CAACK,MAAT,GAAkB,UAACH,IAAD,EAAU;AAC1B,QAAIN,KAAK,CAACM,IAAD,CAAT,EAAiB;AACf,aAAON,KAAK,CAACM,IAAD,CAAZ;AACD;AACF,GAJD;;AAMAF,EAAAA,QAAQ,CAACM,OAAT,GAAmB;AAAA,QAACC,OAAD,uEAAW,EAAX;AAAA,WAAkB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpEpB,MAAAA,WAAW,CAACO,OAAZ,CAAoBc,GAApB,CAAwB,IAAxB;AAEA,UAAMC,QAAQ,GAAG,EAAjB;;AAEA,UAAIb,UAAU,CAACc,MAAX,GAAoB,CAAxB,EAA2B;AACzBd,QAAAA,UAAU,CAACe,OAAX,CAAmB,UAACC,QAAD,EAAc;AAC/BH,UAAAA,QAAQ,CAACR,IAAT,CACEI,OAAO,CAACC,OAAR,CAAgBF,OAAhB,EAAyBS,IAAzB,CAA8B,UAACT,OAAD,EAAa;AACzC,gBAAMN,IAAI,GAAGL,KAAK,CAACmB,QAAD,CAAlB;AACA,mBAAQ,OAAQd,IAAR,KAAkB,UAAnB,GAAiCA,IAAI,CAACM,OAAD,CAArC,GAAiDN,IAAxD;AACD,WAHD,CADF;AAMD,SAPD;AAQD;;AAEDO,MAAAA,OAAO,CAACS,GAAR,CAAYL,QAAZ,EACGI,IADH,CACQ,UAACT,OAAD,EAAa;AACjBjB,QAAAA,WAAW,CAACO,OAAZ,CAAoBc,GAApB,CAAwB,KAAxB;AACAF,QAAAA,OAAO,CAACF,OAAD,CAAP;AACD,OAJH,EAKGW,KALH,CAKS,UAACC,GAAD,EAAS;AACd7B,QAAAA,WAAW,CAACO,OAAZ,CAAoBc,GAApB,CAAwB,KAAxB;AACAD,QAAAA,MAAM,CAACS,GAAD,CAAN;AACD,OARH;AASD,KAzBoC,CAAlB;AAAA,GAAnB;;AA2BAnB,EAAAA,QAAQ,CAACoB,QAAT,GAAoB9B,WAAW,CAACO,OAAhC;AAEA,sBACE,oBAAC,eAAD,CAAiB,QAAjB;AAA0B,IAAA,KAAK,EAAEG;AAAjC,KACGX,KAAK,CAACgC,QADT,CADF;AAKD;;;;"}