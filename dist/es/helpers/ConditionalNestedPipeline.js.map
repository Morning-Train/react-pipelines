{"version":3,"file":"ConditionalNestedPipeline.js","sources":["../../../src/helpers/ConditionalNestedPipeline.js"],"sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport useWillPipe from '../hooks/use-will-pipe'\r\nimport Pipeline from './Pipeline'\r\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\r\nimport get from 'lodash/get'\r\n\r\nexport default function ConditionalNestedPipeline ({ children, when, matches }) {\r\n  const callbackRef = React.useRef(null)\r\n\r\n  const updateCallbackRef = (callback) => {\r\n    callbackRef.current = callback\r\n  }\r\n\r\n  const check = React.useCallback(payload => {\r\n    const value = get(payload, when)\r\n\r\n    if (value === matches) {\r\n      return true\r\n    }\r\n\r\n    if (typeof matches === 'function') {\r\n      return matches(value)\r\n    }\r\n\r\n    return false\r\n  }, [when, matches])\r\n\r\n  useWillPipe((payload) => new Promise((resolve, reject) => {\r\n    if (check(payload)) {\r\n      Promise.resolve(callbackRef.current(payload))\r\n        .then((p = {}) => {\r\n          resolve({ ...payload, ...p })\r\n        })\r\n        .catch((err) => {\r\n          reject(err)\r\n        })\r\n    } else {\r\n      resolve(payload)\r\n    }\r\n  }), [check])\r\n\r\n  return (\r\n    <Pipeline>\r\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\r\n      {children}\r\n    </Pipeline>\r\n  )\r\n}\r\n\r\nConditionalNestedPipeline.propTypes = {\r\n  when: PropTypes.string.isRequired,\r\n  matches: PropTypes.any\r\n}\r\n"],"names":["ConditionalNestedPipeline","children","when","matches","callbackRef","React","useRef","updateCallbackRef","callback","current","check","useCallback","payload","value","get","useWillPipe","Promise","resolve","reject","then","p","catch","err","propTypes","PropTypes","string","isRequired","any"],"mappings":";;;;;;;;;;;AAOe,SAASA,yBAAT,CAAiE,IAAA,EAAA;AAAA,EAA3BC,IAAAA,QAA2B,QAA3BA,QAA2B;AAAA,MAAjBC,IAAiB,QAAjBA,IAAiB;AAAA,MAAXC,OAAW,QAAXA,OAAW,CAAA;AAC9E,EAAA,IAAMC,WAAW,GAAGC,KAAK,CAACC,MAAN,CAAa,IAAb,CAApB,CAAA;;AAEA,EAAA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB,CAAA;AACD,GAFD,CAAA;;AAIA,EAAME,IAAAA,KAAK,GAAGL,KAAK,CAACM,WAAN,CAAkB,UAAAC,OAAO,EAAI;AACzC,IAAA,IAAMC,KAAK,GAAGC,GAAG,CAACF,OAAD,EAAUV,IAAV,CAAjB,CAAA;;AAEA,IAAIW,IAAAA,KAAK,KAAKV,OAAd,EAAuB;AACrB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;AACjC,MAAOA,OAAAA,OAAO,CAACU,KAAD,CAAd,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,KAAP,CAAA;AACD,GAZa,EAYX,CAACX,IAAD,EAAOC,OAAP,CAZW,CAAd,CAAA;AAcAY,EAAAA,WAAW,CAAC,UAACH,OAAD,EAAA;AAAA,IAAA,OAAa,IAAII,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxD,MAAA,IAAIR,KAAK,CAACE,OAAD,CAAT,EAAoB;AAClBI,QAAAA,OAAO,CAACC,OAAR,CAAgBb,WAAW,CAACK,OAAZ,CAAoBG,OAApB,CAAhB,CACGO,CAAAA,IADH,CACQ,YAAY;AAAA,UAAXC,IAAAA,CAAW,uEAAP,EAAO,CAAA;AAChBH,UAAAA,OAAO,CAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAML,OAAN,CAAA,EAAkBQ,CAAlB,CAAP,CAAA,CAAA;AACD,SAHH,CAIGC,CAAAA,KAJH,CAIS,UAACC,GAAD,EAAS;AACdJ,UAAAA,MAAM,CAACI,GAAD,CAAN,CAAA;AACD,SANH,CAAA,CAAA;AAOD,OARD,MAQO;AACLL,QAAAA,OAAO,CAACL,OAAD,CAAP,CAAA;AACD,OAAA;AACF,KAZwB,CAAb,CAAA;AAAA,GAAD,EAYP,CAACF,KAAD,CAZO,CAAX,CAAA;AAcA,EAAA,oBACE,KAAC,CAAA,aAAA,CAAA,QAAD,EACE,IAAA,eAAA,KAAA,CAAA,aAAA,CAAC,yBAAD,EAAA;AAA2B,IAAA,QAAQ,EAAEH,iBAAAA;AAArC,GADF,CAAA,EAEGN,QAFH,CADF,CAAA;AAMD,CAAA;AAEDD,yBAAyB,CAACuB,SAA1B,GAAsC;AACpCrB,EAAAA,IAAI,EAAEsB,SAAS,CAACC,MAAV,CAAiBC,UADa;AAEpCvB,EAAAA,OAAO,EAAEqB,SAAS,CAACG,GAAAA;AAFiB,CAAtC;;;;"}