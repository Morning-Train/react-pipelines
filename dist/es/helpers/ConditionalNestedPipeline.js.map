{"version":3,"file":"ConditionalNestedPipeline.js","sources":["../../../src/helpers/ConditionalNestedPipeline.js"],"sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport useWillPipe from '../hooks/use-will-pipe'\r\nimport Pipeline from './Pipeline'\r\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\r\nimport { get } from 'lodash'\r\n\r\nexport default function ConditionalNestedPipeline ({ children, when, matches }) {\r\n  const callbackRef = React.useRef(null)\r\n\r\n  const updateCallbackRef = (callback) => {\r\n    callbackRef.current = callback\r\n  }\r\n\r\n  useWillPipe((payload) => new Promise((resolve, reject) => {\r\n    if (get(payload, when) === matches) {\r\n      Promise.resolve(callbackRef.current(payload))\r\n        .then((p = {}) => {\r\n          resolve({ ...payload, ...p })\r\n        })\r\n        .catch((err) => {\r\n          reject(err)\r\n        })\r\n    } else {\r\n      resolve(payload)\r\n    }\r\n  }))\r\n\r\n  return (\r\n    <Pipeline>\r\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\r\n      {children}\r\n    </Pipeline>\r\n  )\r\n}\r\n\r\nConditionalNestedPipeline.propTypes = {\r\n  when: PropTypes.string.isRequired,\r\n  matches: PropTypes.any\r\n}\r\n"],"names":["ConditionalNestedPipeline","children","when","matches","callbackRef","React","useRef","updateCallbackRef","callback","current","useWillPipe","payload","Promise","resolve","reject","get","then","p","catch","err","propTypes","PropTypes","string","isRequired","any"],"mappings":";;;;;;;;AAOe,SAASA,yBAAT,OAAiE;AAAA,MAA3BC,QAA2B,QAA3BA,QAA2B;AAAA,MAAjBC,IAAiB,QAAjBA,IAAiB;AAAA,MAAXC,OAAW,QAAXA,OAAW;AAC9E,MAAMC,WAAW,GAAGC,KAAK,CAACC,MAAN,CAAa,IAAb,CAApB;;AAEA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB;AACD,GAFD;;AAIAE,EAAAA,WAAW,CAAC,UAACC,OAAD;AAAA,WAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxD,UAAIC,GAAG,CAACJ,OAAD,EAAUT,IAAV,CAAH,KAAuBC,OAA3B,EAAoC;AAClCS,QAAAA,OAAO,CAACC,OAAR,CAAgBT,WAAW,CAACK,OAAZ,CAAoBE,OAApB,CAAhB,EACGK,IADH,CACQ,YAAY;AAAA,cAAXC,CAAW,uEAAP,EAAO;AAChBJ,UAAAA,OAAO,mCAAMF,OAAN,GAAkBM,CAAlB,EAAP;AACD,SAHH,EAIGC,KAJH,CAIS,UAACC,GAAD,EAAS;AACdL,UAAAA,MAAM,CAACK,GAAD,CAAN;AACD,SANH;AAOD,OARD,MAQO;AACLN,QAAAA,OAAO,CAACF,OAAD,CAAP;AACD;AACF,KAZwB,CAAb;AAAA,GAAD,CAAX;AAcA,sBACE,oBAAC,QAAD,qBACE,oBAAC,yBAAD;AAA2B,IAAA,QAAQ,EAAEJ;AAArC,IADF,EAEGN,QAFH,CADF;AAMD;AAEDD,yBAAyB,CAACoB,SAA1B,GAAsC;AACpClB,EAAAA,IAAI,EAAEmB,SAAS,CAACC,MAAV,CAAiBC,UADa;AAEpCpB,EAAAA,OAAO,EAAEkB,SAAS,CAACG;AAFiB,CAAtC;;;;"}