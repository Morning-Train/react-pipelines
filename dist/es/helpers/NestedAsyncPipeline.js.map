{"version":3,"file":"NestedAsyncPipeline.js","sources":["../../../src/helpers/NestedAsyncPipeline.js"],"sourcesContent":["import React from 'react'\nimport useWillPipe from '../hooks/use-will-pipe'\nimport AsyncPipeline from './AsyncPipeline'\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\n\nexport default function NestedAsyncPipeline ({ children }) {\n  const callbackRef = React.useRef(null)\n\n  const updateCallbackRef = (callback) => {\n    callbackRef.current = callback\n  }\n\n  useWillPipe((payload) => new Promise((resolve, reject) => {\n    Promise.resolve(callbackRef.current(payload))\n      .then((p = {}) => {\n        let finalP = { ...payload }\n\n        if (Array.isArray(p)) {\n          p.forEach((_p) => {\n            finalP = { ...finalP, ..._p }\n          })\n        }\n\n        resolve(finalP)\n      })\n      .catch((err) => {\n        reject(err)\n      })\n  }))\n\n  return (\n    <AsyncPipeline>\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\n      {children}\n    </AsyncPipeline>\n  )\n}\n"],"names":["NestedAsyncPipeline","children","callbackRef","React","useRef","updateCallbackRef","callback","current","useWillPipe","payload","Promise","resolve","reject","then","p","finalP","Array","isArray","forEach","_p","catch","err"],"mappings":";;;;;;AAKe,SAASA,mBAAT,OAA4C;AAAA,MAAZC,QAAY,QAAZA,QAAY;AACzD,MAAMC,WAAW,GAAGC,KAAK,CAACC,MAAN,CAAa,IAAb,CAApB;;AAEA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB;AACD,GAFD;;AAIAE,EAAAA,WAAW,CAAC,UAACC,OAAD;AAAA,WAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxDF,MAAAA,OAAO,CAACC,OAAR,CAAgBT,WAAW,CAACK,OAAZ,CAAoBE,OAApB,CAAhB,EACGI,IADH,CACQ,YAAY;AAAA,YAAXC,CAAW,uEAAP,EAAO;;AAChB,YAAIC,MAAM,sBAAQN,OAAR,CAAV;;AAEA,YAAIO,KAAK,CAACC,OAAN,CAAcH,CAAd,CAAJ,EAAsB;AACpBA,UAAAA,CAAC,CAACI,OAAF,CAAU,UAACC,EAAD,EAAQ;AAChBJ,YAAAA,MAAM,qCAAQA,MAAR,GAAmBI,EAAnB,CAAN;AACD,WAFD;AAGD;;AAEDR,QAAAA,OAAO,CAACI,MAAD,CAAP;AACD,OAXH,EAYGK,KAZH,CAYS,UAACC,GAAD,EAAS;AACdT,QAAAA,MAAM,CAACS,GAAD,CAAN;AACD,OAdH;AAeD,KAhBwB,CAAb;AAAA,GAAD,CAAX;AAkBA,sBACE,oBAAC,aAAD,qBACE,oBAAC,yBAAD;AAA2B,IAAA,QAAQ,EAAEhB;AAArC,IADF,EAEGJ,QAFH,CADF;AAMD;;;;"}