{"version":3,"file":"NestedAsyncPipeline.js","sources":["../../../src/helpers/NestedAsyncPipeline.js"],"sourcesContent":["import React from 'react'\nimport useWillPipe from '../hooks/use-will-pipe'\nimport AsyncPipeline from './AsyncPipeline'\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\n\nexport default function NestedAsyncPipeline ({ children }) {\n  const callbackRef = React.useRef(null)\n\n  const updateCallbackRef = (callback) => {\n    callbackRef.current = callback\n  }\n\n  useWillPipe((payload) => new Promise((resolve, reject) => {\n    Promise.resolve(callbackRef.current(payload))\n      .then((p = {}) => {\n        let finalP = { ...payload }\n\n        if (Array.isArray(p)) {\n          p.forEach((_p) => {\n            finalP = { ...finalP, ..._p }\n          })\n        }\n\n        resolve(finalP)\n      })\n      .catch((err) => {\n        reject(err)\n      })\n  }))\n\n  return (\n    <AsyncPipeline>\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\n      {children}\n    </AsyncPipeline>\n  )\n}\n"],"names":["NestedAsyncPipeline","children","callbackRef","React","useRef","updateCallbackRef","callback","current","useWillPipe","payload","Promise","resolve","reject","then","p","finalP","Array","isArray","forEach","_p","catch","err"],"mappings":";;;;;;;;;AAKe,SAASA,mBAAT,CAA4C,IAAA,EAAA;AAAA,EAAZC,IAAAA,QAAY,QAAZA,QAAY,CAAA;AACzD,EAAA,IAAMC,WAAW,GAAGC,KAAK,CAACC,MAAN,CAAa,IAAb,CAApB,CAAA;;AAEA,EAAA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB,CAAA;AACD,GAFD,CAAA;;AAIAE,EAAAA,WAAW,CAAC,UAACC,OAAD,EAAA;AAAA,IAAA,OAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxDF,MAAAA,OAAO,CAACC,OAAR,CAAgBT,WAAW,CAACK,OAAZ,CAAoBE,OAApB,CAAhB,CACGI,CAAAA,IADH,CACQ,YAAY;AAAA,QAAXC,IAAAA,CAAW,uEAAP,EAAO,CAAA;;AAChB,QAAIC,IAAAA,MAAM,GAAQN,aAAAA,CAAAA,EAAAA,EAAAA,OAAR,CAAV,CAAA;;AAEA,QAAA,IAAIO,KAAK,CAACC,OAAN,CAAcH,CAAd,CAAJ,EAAsB;AACpBA,UAAAA,CAAC,CAACI,OAAF,CAAU,UAACC,EAAD,EAAQ;AAChBJ,YAAAA,MAAM,GAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAQA,MAAR,CAAA,EAAmBI,EAAnB,CAAN,CAAA;AACD,WAFD,CAAA,CAAA;AAGD,SAAA;;AAEDR,QAAAA,OAAO,CAACI,MAAD,CAAP,CAAA;AACD,OAXH,CAYGK,CAAAA,KAZH,CAYS,UAACC,GAAD,EAAS;AACdT,QAAAA,MAAM,CAACS,GAAD,CAAN,CAAA;AACD,OAdH,CAAA,CAAA;AAeD,KAhBwB,CAAb,CAAA;AAAA,GAAD,CAAX,CAAA;AAkBA,EAAA,oBACE,KAAC,CAAA,aAAA,CAAA,aAAD,EACE,IAAA,eAAA,KAAA,CAAA,aAAA,CAAC,yBAAD,EAAA;AAA2B,IAAA,QAAQ,EAAEhB,iBAAAA;AAArC,GADF,CAAA,EAEGJ,QAFH,CADF,CAAA;AAMD;;;;"}