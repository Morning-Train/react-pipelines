{"version":3,"file":"ConditionalNestedAsyncPipeline.js","sources":["../../../src/helpers/ConditionalNestedAsyncPipeline.js"],"sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport useWillPipe from '../hooks/use-will-pipe'\r\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\r\nimport { get } from 'lodash'\r\nimport AsyncPipeline from './AsyncPipeline'\r\n\r\nexport default function ConditionalNestedAsyncPipeline ({ children, when, matches }) {\r\n  const callbackRef = React.useRef(null)\r\n\r\n  const updateCallbackRef = (callback) => {\r\n    callbackRef.current = callback\r\n  }\r\n\r\n  useWillPipe((payload) => new Promise((resolve, reject) => {\r\n    if (get(payload, when) === matches) {\r\n      Promise.resolve(callbackRef.current(payload))\r\n        .then((p = {}) => {\r\n          let finalP = { ...payload }\r\n\r\n          if (Array.isArray(p)) {\r\n            p.forEach((_p) => {\r\n              finalP = { ...finalP, ..._p }\r\n            })\r\n          }\r\n\r\n          resolve(finalP)\r\n        })\r\n        .catch((err) => {\r\n          reject(err)\r\n        })\r\n    } else {\r\n      resolve(payload)\r\n    }\r\n  }))\r\n\r\n  return (\r\n    <AsyncPipeline>\r\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\r\n      {children}\r\n    </AsyncPipeline>\r\n  )\r\n}\r\n\r\nConditionalNestedAsyncPipeline.propTypes = {\r\n  when: PropTypes.string.isRequired,\r\n  matches: PropTypes.any\r\n}\r\n"],"names":["ConditionalNestedAsyncPipeline","children","when","matches","callbackRef","React","useRef","updateCallbackRef","callback","current","useWillPipe","payload","Promise","resolve","reject","get","then","p","finalP","Array","isArray","forEach","_p","catch","err","propTypes","PropTypes","string","isRequired","any"],"mappings":";;;;;;;;AAOe,SAASA,8BAAT,OAAsE;AAAA,MAA3BC,QAA2B,QAA3BA,QAA2B;AAAA,MAAjBC,IAAiB,QAAjBA,IAAiB;AAAA,MAAXC,OAAW,QAAXA,OAAW;AACnF,MAAMC,WAAW,GAAGC,KAAK,CAACC,MAAN,CAAa,IAAb,CAApB;;AAEA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB;AACD,GAFD;;AAIAE,EAAAA,WAAW,CAAC,UAACC,OAAD;AAAA,WAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxD,UAAIC,GAAG,CAACJ,OAAD,EAAUT,IAAV,CAAH,KAAuBC,OAA3B,EAAoC;AAClCS,QAAAA,OAAO,CAACC,OAAR,CAAgBT,WAAW,CAACK,OAAZ,CAAoBE,OAApB,CAAhB,EACGK,IADH,CACQ,YAAY;AAAA,cAAXC,CAAW,uEAAP,EAAO;;AAChB,cAAIC,MAAM,sBAAQP,OAAR,CAAV;;AAEA,cAAIQ,KAAK,CAACC,OAAN,CAAcH,CAAd,CAAJ,EAAsB;AACpBA,YAAAA,CAAC,CAACI,OAAF,CAAU,UAACC,EAAD,EAAQ;AAChBJ,cAAAA,MAAM,qCAAQA,MAAR,GAAmBI,EAAnB,CAAN;AACD,aAFD;AAGD;;AAEDT,UAAAA,OAAO,CAACK,MAAD,CAAP;AACD,SAXH,EAYGK,KAZH,CAYS,UAACC,GAAD,EAAS;AACdV,UAAAA,MAAM,CAACU,GAAD,CAAN;AACD,SAdH;AAeD,OAhBD,MAgBO;AACLX,QAAAA,OAAO,CAACF,OAAD,CAAP;AACD;AACF,KApBwB,CAAb;AAAA,GAAD,CAAX;AAsBA,sBACE,oBAAC,aAAD,qBACE,oBAAC,yBAAD;AAA2B,IAAA,QAAQ,EAAEJ;AAArC,IADF,EAEGN,QAFH,CADF;AAMD;AAEDD,8BAA8B,CAACyB,SAA/B,GAA2C;AACzCvB,EAAAA,IAAI,EAAEwB,SAAS,CAACC,MAAV,CAAiBC,UADkB;AAEzCzB,EAAAA,OAAO,EAAEuB,SAAS,CAACG;AAFsB,CAA3C;;;;"}