{"version":3,"file":"AsyncPipeline.js","sources":["../../../src/helpers/AsyncPipeline.js"],"sourcesContent":["import React from 'react';\nimport { observable } from 'mobx';\nimport PipelineContext from '../contexts/PipelineContext';\nimport sequentialPipelineTrigger from '../utilities/sequentialPipelineTrigger';\nimport parallelPipelineTrigger from '../utilities/parallelPipelineTrigger';\n\nfunction AsyncPipeline({ children }) {\n  const isPipingRef = React.useRef(observable.box());\n\n  const pipesRef = React.useRef({});\n  const pipes = pipesRef.current;\n\n  const pipesOrderRef = React.useRef([]);\n  const pipesOrder = pipesOrderRef.current;\n\n  const pipeline = {};\n\n  pipeline.pipe = (uuid, pipe) => {\n    if (!pipesOrder.includes(uuid)) {\n      pipesOrder.push(uuid);\n    }\n\n    pipes[uuid] = pipe;\n\n    return () => {\n      pipeline.remove(uuid);\n    };\n  };\n\n  pipeline.remove = (uuid) => {\n    if (pipes[uuid]) {\n      delete pipes[uuid];\n    }\n  };\n\n  pipeline.trigger = React.useCallback((payload = {}) => {\n    isPipingRef.current.set(true);\n\n    return new Promise((resolve, reject) => {\n      parallelPipelineTrigger(pipesOrder, pipes)(payload)\n        .then((p) => {\n          isPipingRef.current.set(false);\n          resolve(p);\n        })\n        .catch((err) => {\n          isPipingRef.current.set(false);\n          reject(err);\n        });\n    });\n  }, [pipesOrder, pipes]);\n\n  pipeline.isPiping = isPipingRef.current;\n\n  return (\n    <PipelineContext.Provider value={pipeline}>\n      {children}\n    </PipelineContext.Provider>\n  );\n}\n\nexport default AsyncPipeline;\n"],"names":["AsyncPipeline","children","isPipingRef","React","useRef","observable","box","pipesRef","pipes","current","pipesOrderRef","pipesOrder","pipeline","pipe","uuid","includes","push","remove","trigger","useCallback","payload","set","Promise","resolve","reject","parallelPipelineTrigger","then","p","catch","err","isPiping","PipelineContext"],"mappings":";;;;;;;;;;;AAMA,SAASA,aAAT,OAAqC;AAAA,MAAZC,QAAY,QAAZA,QAAY;AACnC,MAAMC,WAAW,GAAGC,yBAAK,CAACC,MAAN,CAAaC,eAAU,CAACC,GAAX,EAAb,CAApB;AAEA,MAAMC,QAAQ,GAAGJ,yBAAK,CAACC,MAAN,CAAa,EAAb,CAAjB;AACA,MAAMI,KAAK,GAAGD,QAAQ,CAACE,OAAvB;AAEA,MAAMC,aAAa,GAAGP,yBAAK,CAACC,MAAN,CAAa,EAAb,CAAtB;AACA,MAAMO,UAAU,GAAGD,aAAa,CAACD,OAAjC;AAEA,MAAMG,QAAQ,GAAG,EAAjB;;AAEAA,EAAAA,QAAQ,CAACC,IAAT,GAAgB,UAACC,IAAD,EAAOD,IAAP,EAAgB;AAC9B,QAAI,CAACF,UAAU,CAACI,QAAX,CAAoBD,IAApB,CAAL,EAAgC;AAC9BH,MAAAA,UAAU,CAACK,IAAX,CAAgBF,IAAhB;AACD;;AAEDN,IAAAA,KAAK,CAACM,IAAD,CAAL,GAAcD,IAAd;AAEA,WAAO,YAAM;AACXD,MAAAA,QAAQ,CAACK,MAAT,CAAgBH,IAAhB;AACD,KAFD;AAGD,GAVD;;AAYAF,EAAAA,QAAQ,CAACK,MAAT,GAAkB,UAACH,IAAD,EAAU;AAC1B,QAAIN,KAAK,CAACM,IAAD,CAAT,EAAiB;AACf,aAAON,KAAK,CAACM,IAAD,CAAZ;AACD;AACF,GAJD;;AAMAF,EAAAA,QAAQ,CAACM,OAAT,GAAmBf,yBAAK,CAACgB,WAAN,CAAkB,YAAkB;AAAA,QAAjBC,OAAiB,uEAAP,EAAO;AACrDlB,IAAAA,WAAW,CAACO,OAAZ,CAAoBY,GAApB,CAAwB,IAAxB;AAEA,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCC,MAAAA,uBAAuB,CAACd,UAAD,EAAaH,KAAb,CAAvB,CAA2CY,OAA3C,EACGM,IADH,CACQ,UAACC,CAAD,EAAO;AACXzB,QAAAA,WAAW,CAACO,OAAZ,CAAoBY,GAApB,CAAwB,KAAxB;AACAE,QAAAA,OAAO,CAACI,CAAD,CAAP;AACD,OAJH,EAKGC,KALH,CAKS,UAACC,GAAD,EAAS;AACd3B,QAAAA,WAAW,CAACO,OAAZ,CAAoBY,GAApB,CAAwB,KAAxB;AACAG,QAAAA,MAAM,CAACK,GAAD,CAAN;AACD,OARH;AASD,KAVM,CAAP;AAWD,GAdkB,EAchB,CAAClB,UAAD,EAAaH,KAAb,CAdgB,CAAnB;AAgBAI,EAAAA,QAAQ,CAACkB,QAAT,GAAoB5B,WAAW,CAACO,OAAhC;AAEA,sBACEN,wCAAC4B,0BAAD,CAAiB,QAAjB;AAA0B,IAAA,KAAK,EAAEnB;AAAjC,KACGX,QADH,CADF;AAKD;;;;"}