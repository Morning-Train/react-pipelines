{"version":3,"file":"AsyncPipeline.js","sources":["../../../src/helpers/AsyncPipeline.js"],"sourcesContent":["import React from 'react'\nimport PipelineContext from '../contexts/PipelineContext'\nimport parallelPipelineTrigger from '../utilities/parallelPipelineTrigger'\nimport useEventListeners from '../hooks/use-event-listeners'\n\nfunction AsyncPipeline ({ children }) {\n  const isPipingRef = React.useRef(false)\n\n  const pipesRef = React.useRef({})\n  const pipes = pipesRef.current\n\n  const pipesOrderRef = React.useRef([])\n  const pipesOrder = pipesOrderRef.current\n\n  const [triggerOnIsPipingChange, onIsPipingChange] = useEventListeners()\n\n  const pipeline = {\n    onIsPipingChange\n  }\n\n  pipeline.pipe = (uuid, pipe) => {\n    if (!pipesOrder.includes(uuid)) {\n      pipesOrder.push(uuid)\n    }\n\n    pipes[uuid] = pipe\n\n    return () => {\n      pipeline.remove(uuid)\n    }\n  }\n\n  pipeline.remove = (uuid) => {\n    if (pipes[uuid]) {\n      delete pipes[uuid]\n    }\n  }\n\n  pipeline.trigger = React.useCallback((payload = {}) => {\n    isPipingRef.current = true\n    triggerOnIsPipingChange(isPipingRef.current)\n\n    return new Promise((resolve, reject) => {\n      parallelPipelineTrigger(pipesOrder, pipes)(payload)\n        .then((p) => {\n          isPipingRef.current = false\n          triggerOnIsPipingChange(isPipingRef.current)\n          resolve(p)\n        })\n        .catch((err) => {\n          isPipingRef.current = false\n          triggerOnIsPipingChange(isPipingRef.current)\n          reject(err)\n        })\n    })\n  }, [pipesOrder, pipes])\n\n  pipeline.isPiping = isPipingRef.current\n\n  return (\n    <PipelineContext.Provider value={pipeline}>\n      {children}\n    </PipelineContext.Provider>\n  )\n}\n\nexport default AsyncPipeline\n"],"names":["AsyncPipeline","children","isPipingRef","React","useRef","pipesRef","pipes","current","pipesOrderRef","pipesOrder","useEventListeners","triggerOnIsPipingChange","onIsPipingChange","pipeline","pipe","uuid","includes","push","remove","trigger","useCallback","payload","Promise","resolve","reject","parallelPipelineTrigger","then","p","catch","err","isPiping","PipelineContext"],"mappings":";;;;;;;;;;;;AAKA,SAASA,aAAT,OAAsC;AAAA,MAAZC,QAAY,QAAZA,QAAY;AACpC,MAAMC,WAAW,GAAGC,yBAAK,CAACC,MAAN,CAAa,KAAb,CAApB;AAEA,MAAMC,QAAQ,GAAGF,yBAAK,CAACC,MAAN,CAAa,EAAb,CAAjB;AACA,MAAME,KAAK,GAAGD,QAAQ,CAACE,OAAvB;AAEA,MAAMC,aAAa,GAAGL,yBAAK,CAACC,MAAN,CAAa,EAAb,CAAtB;AACA,MAAMK,UAAU,GAAGD,aAAa,CAACD,OAAjC;;AAPoC,2BASgBG,iBAAiB,EATjC;AAAA;AAAA,MAS7BC,uBAT6B;AAAA,MASJC,gBATI;;AAWpC,MAAMC,QAAQ,GAAG;AACfD,IAAAA,gBAAgB,EAAhBA;AADe,GAAjB;;AAIAC,EAAAA,QAAQ,CAACC,IAAT,GAAgB,UAACC,IAAD,EAAOD,IAAP,EAAgB;AAC9B,QAAI,CAACL,UAAU,CAACO,QAAX,CAAoBD,IAApB,CAAL,EAAgC;AAC9BN,MAAAA,UAAU,CAACQ,IAAX,CAAgBF,IAAhB;AACD;;AAEDT,IAAAA,KAAK,CAACS,IAAD,CAAL,GAAcD,IAAd;AAEA,WAAO,YAAM;AACXD,MAAAA,QAAQ,CAACK,MAAT,CAAgBH,IAAhB;AACD,KAFD;AAGD,GAVD;;AAYAF,EAAAA,QAAQ,CAACK,MAAT,GAAkB,UAACH,IAAD,EAAU;AAC1B,QAAIT,KAAK,CAACS,IAAD,CAAT,EAAiB;AACf,aAAOT,KAAK,CAACS,IAAD,CAAZ;AACD;AACF,GAJD;;AAMAF,EAAAA,QAAQ,CAACM,OAAT,GAAmBhB,yBAAK,CAACiB,WAAN,CAAkB,YAAkB;AAAA,QAAjBC,OAAiB,uEAAP,EAAO;AACrDnB,IAAAA,WAAW,CAACK,OAAZ,GAAsB,IAAtB;AACAI,IAAAA,uBAAuB,CAACT,WAAW,CAACK,OAAb,CAAvB;AAEA,WAAO,IAAIe,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCC,MAAAA,uBAAuB,CAAChB,UAAD,EAAaH,KAAb,CAAvB,CAA2Ce,OAA3C,EACGK,IADH,CACQ,UAACC,CAAD,EAAO;AACXzB,QAAAA,WAAW,CAACK,OAAZ,GAAsB,KAAtB;AACAI,QAAAA,uBAAuB,CAACT,WAAW,CAACK,OAAb,CAAvB;AACAgB,QAAAA,OAAO,CAACI,CAAD,CAAP;AACD,OALH,EAMGC,KANH,CAMS,UAACC,GAAD,EAAS;AACd3B,QAAAA,WAAW,CAACK,OAAZ,GAAsB,KAAtB;AACAI,QAAAA,uBAAuB,CAACT,WAAW,CAACK,OAAb,CAAvB;AACAiB,QAAAA,MAAM,CAACK,GAAD,CAAN;AACD,OAVH;AAWD,KAZM,CAAP;AAaD,GAjBkB,EAiBhB,CAACpB,UAAD,EAAaH,KAAb,CAjBgB,CAAnB;AAmBAO,EAAAA,QAAQ,CAACiB,QAAT,GAAoB5B,WAAW,CAACK,OAAhC;AAEA,sBACEJ,wCAAC4B,0BAAD,CAAiB,QAAjB;AAA0B,IAAA,KAAK,EAAElB;AAAjC,KACGZ,QADH,CADF;AAKD;;;;"}