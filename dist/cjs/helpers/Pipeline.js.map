{"version":3,"file":"Pipeline.js","sources":["../../../src/helpers/Pipeline.js"],"sourcesContent":["import React from 'react';\nimport { observable } from 'mobx';\nimport PipelineContext from '../contexts/PipelineContext';\n\nfunction Pipeline(props) {\n  const isPipingRef = React.useRef(observable.box());\n\n  const pipesRef = React.useRef({});\n  const pipes = pipesRef.current;\n\n  const pipesOrderRef = React.useRef([]);\n  const pipesOrder = pipesOrderRef.current;\n\n  const pipeline = {};\n\n  pipeline.pipe = (uuid, pipe) => {\n    if (!pipesOrder.includes(uuid)) {\n      pipesOrder.push(uuid);\n    }\n\n    pipes[uuid] = pipe;\n\n    return () => {\n      pipeline.remove(uuid);\n    };\n  };\n\n  pipeline.remove = (uuid) => {\n    if (pipes[uuid]) {\n      delete pipes[uuid];\n    }\n  };\n\n  pipeline.trigger = (payload = {}) => new Promise((resolve, reject) => {\n    isPipingRef.current.set(true);\n\n    let promise = Promise.resolve(payload);\n\n    if (pipesOrder.length > 0) {\n      pipesOrder.forEach((pipeUuid) => {\n        promise = promise.then((payload) => {\n          const pipe = pipes[pipeUuid];\n          return (typeof (pipe) === 'function') ? pipe(payload) : pipe;\n        });\n      });\n    }\n\n    promise\n      .then((payload) => {\n        isPipingRef.current.set(false);\n        resolve(payload);\n      })\n      .catch((err) => {\n        isPipingRef.current.set(false);\n        reject(err);\n      });\n  });\n\n  pipeline.isPiping = isPipingRef.current;\n\n  return (\n    <PipelineContext.Provider value={pipeline}>\n      {props.children}\n    </PipelineContext.Provider>\n  );\n}\n\nexport default Pipeline;\n"],"names":["Pipeline","props","isPipingRef","React","useRef","observable","box","pipesRef","pipes","current","pipesOrderRef","pipesOrder","pipeline","pipe","uuid","includes","push","remove","trigger","payload","Promise","resolve","reject","set","promise","length","forEach","pipeUuid","then","catch","err","isPiping","PipelineContext","children"],"mappings":";;;;;;;;;;AAIA,SAASA,QAAT,CAAkBC,KAAlB,EAAyB;AACvB,MAAMC,WAAW,GAAGC,yBAAK,CAACC,MAAN,CAAaC,eAAU,CAACC,GAAX,EAAb,CAApB;AAEA,MAAMC,QAAQ,GAAGJ,yBAAK,CAACC,MAAN,CAAa,EAAb,CAAjB;AACA,MAAMI,KAAK,GAAGD,QAAQ,CAACE,OAAvB;AAEA,MAAMC,aAAa,GAAGP,yBAAK,CAACC,MAAN,CAAa,EAAb,CAAtB;AACA,MAAMO,UAAU,GAAGD,aAAa,CAACD,OAAjC;AAEA,MAAMG,QAAQ,GAAG,EAAjB;;AAEAA,EAAAA,QAAQ,CAACC,IAAT,GAAgB,UAACC,IAAD,EAAOD,IAAP,EAAgB;AAC9B,QAAI,CAACF,UAAU,CAACI,QAAX,CAAoBD,IAApB,CAAL,EAAgC;AAC9BH,MAAAA,UAAU,CAACK,IAAX,CAAgBF,IAAhB;AACD;;AAEDN,IAAAA,KAAK,CAACM,IAAD,CAAL,GAAcD,IAAd;AAEA,WAAO,YAAM;AACXD,MAAAA,QAAQ,CAACK,MAAT,CAAgBH,IAAhB;AACD,KAFD;AAGD,GAVD;;AAYAF,EAAAA,QAAQ,CAACK,MAAT,GAAkB,UAACH,IAAD,EAAU;AAC1B,QAAIN,KAAK,CAACM,IAAD,CAAT,EAAiB;AACf,aAAON,KAAK,CAACM,IAAD,CAAZ;AACD;AACF,GAJD;;AAMAF,EAAAA,QAAQ,CAACM,OAAT,GAAmB;AAAA,QAACC,OAAD,uEAAW,EAAX;AAAA,WAAkB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpEpB,MAAAA,WAAW,CAACO,OAAZ,CAAoBc,GAApB,CAAwB,IAAxB;AAEA,UAAIC,OAAO,GAAGJ,OAAO,CAACC,OAAR,CAAgBF,OAAhB,CAAd;;AAEA,UAAIR,UAAU,CAACc,MAAX,GAAoB,CAAxB,EAA2B;AACzBd,QAAAA,UAAU,CAACe,OAAX,CAAmB,UAACC,QAAD,EAAc;AAC/BH,UAAAA,OAAO,GAAGA,OAAO,CAACI,IAAR,CAAa,UAACT,OAAD,EAAa;AAClC,gBAAMN,IAAI,GAAGL,KAAK,CAACmB,QAAD,CAAlB;AACA,mBAAQ,OAAQd,IAAR,KAAkB,UAAnB,GAAiCA,IAAI,CAACM,OAAD,CAArC,GAAiDN,IAAxD;AACD,WAHS,CAAV;AAID,SALD;AAMD;;AAEDW,MAAAA,OAAO,CACJI,IADH,CACQ,UAACT,OAAD,EAAa;AACjBjB,QAAAA,WAAW,CAACO,OAAZ,CAAoBc,GAApB,CAAwB,KAAxB;AACAF,QAAAA,OAAO,CAACF,OAAD,CAAP;AACD,OAJH,EAKGU,KALH,CAKS,UAACC,GAAD,EAAS;AACd5B,QAAAA,WAAW,CAACO,OAAZ,CAAoBc,GAApB,CAAwB,KAAxB;AACAD,QAAAA,MAAM,CAACQ,GAAD,CAAN;AACD,OARH;AASD,KAvBoC,CAAlB;AAAA,GAAnB;;AAyBAlB,EAAAA,QAAQ,CAACmB,QAAT,GAAoB7B,WAAW,CAACO,OAAhC;AAEA,sBACEN,wCAAC6B,0BAAD,CAAiB,QAAjB;AAA0B,IAAA,KAAK,EAAEpB;AAAjC,KACGX,KAAK,CAACgC,QADT,CADF;AAKD;;;;"}