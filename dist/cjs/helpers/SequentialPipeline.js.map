{"version":3,"file":"SequentialPipeline.js","sources":["../../../src/helpers/SequentialPipeline.js"],"sourcesContent":["import React from 'react'\nimport PipelineContext from '../contexts/PipelineContext'\nimport sequentialPipelineTrigger from '../utilities/sequentialPipelineTrigger'\nimport useEventListeners from '../hooks/use-event-listeners'\n\nexport default function SequentialPipeline ({ children }) {\n  const isPipingRef = React.useRef(false)\n\n  const pipesRef = React.useRef({})\n  const pipes = pipesRef.current\n\n  const pipesOrderRef = React.useRef([])\n  const pipesOrder = pipesOrderRef.current\n\n  const [triggerOnIsPipingChange, onIsPipingChange] = useEventListeners()\n  const [triggerOnError, onError] = useEventListeners()\n\n  const pipeline = {\n    onIsPipingChange,\n    get isPiping() {\n      return isPipingRef.current\n    }\n  }\n\n  pipeline.pipe = (uuid, pipe) => {\n    if (!pipesOrder.includes(uuid)) {\n      pipesOrder.push(uuid)\n    }\n\n    pipes[uuid] = pipe\n\n    return () => {\n      pipeline.remove(uuid)\n    }\n  }\n\n  pipeline.remove = (uuid) => {\n    if (pipes[uuid]) {\n      delete pipes[uuid]\n    }\n  }\n\n  pipeline.trigger = React.useCallback((payload = {}) => {\n    isPipingRef.current = true\n    triggerOnIsPipingChange(isPipingRef.current)\n\n    return new Promise((resolve, reject) => {\n      sequentialPipelineTrigger(pipesOrder, pipes)(payload)\n        .then((p) => {\n          isPipingRef.current = false\n          triggerOnIsPipingChange(isPipingRef.current)\n          resolve(p)\n        })\n        .catch((err) => {\n          isPipingRef.current = false\n          triggerOnIsPipingChange(isPipingRef.current)\n          triggerOnError(err)\n          reject(err)\n        })\n    })\n  }, [pipesOrder, pipes])\n\n  pipeline.onError = onError\n\n  return (\n    <PipelineContext.Provider value={pipeline}>\n      {children}\n    </PipelineContext.Provider>\n  )\n}\n"],"names":["SequentialPipeline","children","isPipingRef","React","useRef","pipesRef","pipes","current","pipesOrderRef","pipesOrder","useEventListeners","_slicedToArray","triggerOnIsPipingChange","onIsPipingChange","triggerOnError","onError","pipeline","isPiping","pipe","uuid","includes","push","remove","trigger","useCallback","payload","Promise","resolve","reject","sequentialPipelineTrigger","then","p","catch","err"],"mappings":"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"}