{"version":3,"file":"ConditionalNestedAsyncPipeline.js","sources":["../../../src/helpers/ConditionalNestedAsyncPipeline.js"],"sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport useWillPipe from '../hooks/use-will-pipe'\r\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\r\nimport { get } from 'lodash'\r\nimport AsyncPipeline from './AsyncPipeline'\r\n\r\nexport default function ConditionalNestedAsyncPipeline ({ children, when, matches }) {\r\n  const callbackRef = React.useRef(null)\r\n\r\n  const updateCallbackRef = (callback) => {\r\n    callbackRef.current = callback\r\n  }\r\n\r\n  function check (payload) {\r\n    const value = get(payload, when)\r\n\r\n    if (value === matches) {\r\n      return true\r\n    }\r\n\r\n    if (typeof matches === 'function') {\r\n      return matches(value)\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  useWillPipe((payload) => new Promise((resolve, reject) => {\r\n    if (check(payload)) {\r\n      Promise.resolve(callbackRef.current(payload))\r\n        .then((p = {}) => {\r\n          let finalP = { ...payload }\r\n\r\n          if (Array.isArray(p)) {\r\n            p.forEach((_p) => {\r\n              finalP = { ...finalP, ..._p }\r\n            })\r\n          }\r\n\r\n          resolve(finalP)\r\n        })\r\n        .catch((err) => {\r\n          reject(err)\r\n        })\r\n    } else {\r\n      resolve(payload)\r\n    }\r\n  }))\r\n\r\n  return (\r\n    <AsyncPipeline>\r\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\r\n      {children}\r\n    </AsyncPipeline>\r\n  )\r\n}\r\n\r\nConditionalNestedAsyncPipeline.propTypes = {\r\n  when: PropTypes.string.isRequired,\r\n  matches: PropTypes.any\r\n}\r\n"],"names":["ConditionalNestedAsyncPipeline","children","when","matches","callbackRef","React","useRef","updateCallbackRef","callback","current","check","payload","value","get","useWillPipe","Promise","resolve","reject","then","p","finalP","Array","isArray","forEach","_p","catch","err","propTypes","PropTypes","string","isRequired","any"],"mappings":";;;;;;;;;;;;;;;AAOe,SAASA,8BAAT,OAAsE;AAAA,MAA3BC,QAA2B,QAA3BA,QAA2B;AAAA,MAAjBC,IAAiB,QAAjBA,IAAiB;AAAA,MAAXC,OAAW,QAAXA,OAAW;AACnF,MAAMC,WAAW,GAAGC,yBAAK,CAACC,MAAN,CAAa,IAAb,CAApB;;AAEA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB;AACD,GAFD;;AAIA,WAASE,KAAT,CAAgBC,OAAhB,EAAyB;AACvB,QAAMC,KAAK,GAAGC,UAAG,CAACF,OAAD,EAAUT,IAAV,CAAjB;;AAEA,QAAIU,KAAK,KAAKT,OAAd,EAAuB;AACrB,aAAO,IAAP;AACD;;AAED,QAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;AACjC,aAAOA,OAAO,CAACS,KAAD,CAAd;AACD;;AAED,WAAO,KAAP;AACD;;AAEDE,EAAAA,WAAW,CAAC,UAACH,OAAD;AAAA,WAAa,IAAII,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxD,UAAIP,KAAK,CAACC,OAAD,CAAT,EAAoB;AAClBI,QAAAA,OAAO,CAACC,OAAR,CAAgBZ,WAAW,CAACK,OAAZ,CAAoBE,OAApB,CAAhB,EACGO,IADH,CACQ,YAAY;AAAA,cAAXC,CAAW,uEAAP,EAAO;;AAChB,cAAIC,MAAM,+CAAQT,OAAR,CAAV;;AAEA,cAAIU,KAAK,CAACC,OAAN,CAAcH,CAAd,CAAJ,EAAsB;AACpBA,YAAAA,CAAC,CAACI,OAAF,CAAU,UAACC,EAAD,EAAQ;AAChBJ,cAAAA,MAAM,uFAAQA,MAAR,GAAmBI,EAAnB,CAAN;AACD,aAFD;AAGD;;AAEDR,UAAAA,OAAO,CAACI,MAAD,CAAP;AACD,SAXH,EAYGK,KAZH,CAYS,UAACC,GAAD,EAAS;AACdT,UAAAA,MAAM,CAACS,GAAD,CAAN;AACD,SAdH;AAeD,OAhBD,MAgBO;AACLV,QAAAA,OAAO,CAACL,OAAD,CAAP;AACD;AACF,KApBwB,CAAb;AAAA,GAAD,CAAX;AAsBA,sBACEN,wCAAC,aAAD,qBACEA,wCAAC,yBAAD;AAA2B,IAAA,QAAQ,EAAEE;AAArC,IADF,EAEGN,QAFH,CADF;AAMD;AAEDD,8BAA8B,CAAC2B,SAA/B,GAA2C;AACzCzB,EAAAA,IAAI,EAAE0B,6BAAS,CAACC,MAAV,CAAiBC,UADkB;AAEzC3B,EAAAA,OAAO,EAAEyB,6BAAS,CAACG;AAFsB,CAA3C;;;;"}