{"version":3,"file":"ConditionalNestedPipeline.js","sources":["../../../src/helpers/ConditionalNestedPipeline.js"],"sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport useWillPipe from '../hooks/use-will-pipe'\r\nimport Pipeline from './Pipeline'\r\nimport TriggerPipelineOnCallback from '../triggers/TriggerPipelineOnCallback'\r\nimport get from 'lodash/get'\r\n\r\nexport default function ConditionalNestedPipeline ({ children, when, matches }) {\r\n  const callbackRef = React.useRef(null)\r\n\r\n  const updateCallbackRef = (callback) => {\r\n    callbackRef.current = callback\r\n  }\r\n\r\n  const check = React.useCallback(payload => {\r\n    const value = get(payload, when)\r\n\r\n    if (value === matches) {\r\n      return true\r\n    }\r\n\r\n    if (typeof matches === 'function') {\r\n      return matches(value)\r\n    }\r\n\r\n    return false\r\n  }, [when, matches])\r\n\r\n  useWillPipe((payload) => new Promise((resolve, reject) => {\r\n    if (check(payload)) {\r\n      Promise.resolve(callbackRef.current(payload))\r\n        .then((p = {}) => {\r\n          resolve({ ...payload, ...p })\r\n        })\r\n        .catch((err) => {\r\n          reject(err)\r\n        })\r\n    } else {\r\n      resolve(payload)\r\n    }\r\n  }), [check])\r\n\r\n  return (\r\n    <Pipeline>\r\n      <TriggerPipelineOnCallback callback={updateCallbackRef} />\r\n      {children}\r\n    </Pipeline>\r\n  )\r\n}\r\n\r\nConditionalNestedPipeline.propTypes = {\r\n  when: PropTypes.string.isRequired,\r\n  matches: PropTypes.any\r\n}\r\n"],"names":["ConditionalNestedPipeline","children","when","matches","callbackRef","React","useRef","updateCallbackRef","callback","current","check","useCallback","payload","value","get","useWillPipe","Promise","resolve","reject","then","p","catch","err","propTypes","PropTypes","string","isRequired","any"],"mappings":";;;;;;;;;;;;;;;;AAOe,SAASA,yBAAT,OAAiE;AAAA,MAA3BC,QAA2B,QAA3BA,QAA2B;AAAA,MAAjBC,IAAiB,QAAjBA,IAAiB;AAAA,MAAXC,OAAW,QAAXA,OAAW;AAC9E,MAAMC,WAAW,GAAGC,yBAAK,CAACC,MAAN,CAAa,IAAb,CAApB;;AAEA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAc;AACtCJ,IAAAA,WAAW,CAACK,OAAZ,GAAsBD,QAAtB;AACD,GAFD;;AAIA,MAAME,KAAK,GAAGL,yBAAK,CAACM,WAAN,CAAkB,UAAAC,OAAO,EAAI;AACzC,QAAMC,KAAK,GAAGC,uBAAG,CAACF,OAAD,EAAUV,IAAV,CAAjB;;AAEA,QAAIW,KAAK,KAAKV,OAAd,EAAuB;AACrB,aAAO,IAAP;AACD;;AAED,QAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;AACjC,aAAOA,OAAO,CAACU,KAAD,CAAd;AACD;;AAED,WAAO,KAAP;AACD,GAZa,EAYX,CAACX,IAAD,EAAOC,OAAP,CAZW,CAAd;AAcAY,EAAAA,WAAW,CAAC,UAACH,OAAD;AAAA,WAAa,IAAII,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxD,UAAIR,KAAK,CAACE,OAAD,CAAT,EAAoB;AAClBI,QAAAA,OAAO,CAACC,OAAR,CAAgBb,WAAW,CAACK,OAAZ,CAAoBG,OAApB,CAAhB,EACGO,IADH,CACQ,YAAY;AAAA,cAAXC,CAAW,uEAAP,EAAO;AAChBH,UAAAA,OAAO,qFAAML,OAAN,GAAkBQ,CAAlB,EAAP;AACD,SAHH,EAIGC,KAJH,CAIS,UAACC,GAAD,EAAS;AACdJ,UAAAA,MAAM,CAACI,GAAD,CAAN;AACD,SANH;AAOD,OARD,MAQO;AACLL,QAAAA,OAAO,CAACL,OAAD,CAAP;AACD;AACF,KAZwB,CAAb;AAAA,GAAD,EAYP,CAACF,KAAD,CAZO,CAAX;AAcA,sBACEL,wCAAC,QAAD,qBACEA,wCAAC,yBAAD;AAA2B,IAAA,QAAQ,EAAEE;AAArC,IADF,EAEGN,QAFH,CADF;AAMD;AAEDD,yBAAyB,CAACuB,SAA1B,GAAsC;AACpCrB,EAAAA,IAAI,EAAEsB,6BAAS,CAACC,MAAV,CAAiBC,UADa;AAEpCvB,EAAAA,OAAO,EAAEqB,6BAAS,CAACG;AAFiB,CAAtC;;;;"}